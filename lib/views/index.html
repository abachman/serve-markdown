<!doctype html>
<html>
  <head>
    <style>
      body{font-family:Helvetica,Arial,Freesans,clean,sans-serif;padding:1em;margin:auto;max-width:42em;background:#fefefe}
      h1,h2,h3,h4,h5,h6{font-weight:700}
      h1{color:#000;font-size:28px}
      h2{border-bottom: 2px solid #ccc;color:#000;font-size:24px;margin-top:48px}
      h3{border-bottom: 1px solid #ddd;font-size:18px;margin-top:34px}
      h4{font-size:16px;margin-top:28px}
      h5{font-size:14px}
      h6{color:#777;background-color:inherit;font-size:14px}
      hr{height:.2em;border:0;color:#ccc;background-color:#ccc}
      blockquote,dl,li,ol,p,pre,table,ul{margin:15px 0}
      a,a:visited{color:#4183c4;background-color:inherit;text-decoration:none}
    </style>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <title><%= title %></title>
  </head>
  <body>
    <div>
      <button onclick="reload(); return false">reload</button> <span id="ts"></span>
    </div>
    <div id="contents"></div>
    <script>
      function reload() {
        fetch(window.location.href + 'html')
        .then(function (response) {
          return response.json()
        }).then(function (data) {
          console.log("loaded", data.contents.length, "bytes at", data.ts)
          document.getElementById('contents').innerHTML = data.contents
          document.getElementById('ts').innerHTML = data.ts
          document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
          });
        })
      }
      reload()

      var exampleSocket = new WebSocket("ws://localhost:<%= port %>/changes")
      exampleSocket.onmessage = reload
    </script>
  </body>
</html>
